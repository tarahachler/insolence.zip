<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Carte des projets ‚Äî Prototype</title>
  <link rel="stylesheet" href="style.css" />
  <!-- p5.js -->
  <script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
  <!-- (Option) Firebase compat scripts si tu veux passer au cloud plus bas -->
  <!--
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  -->
</head>
<body>
  <div id="leftPanel" class="panel hidden">
    <button id="closePanel" title="Fermer">‚úï</button>
    <div id="projectDetail">
      <!-- Contenu inject√© par JS -->
    </div>
  </div>


  <div id="mapContainer">
    <div id="mapInner">
        <object id="mapThin" type="image/svg+xml" data="public/images/thin.svg" style="stroke-width: 2;"></object>
        <object id="mapThick" type="image/svg+xml" data="public/images/thick.svg"></object>

      <!-- p5 cr√©era un canvas ici (via parent) -->
      <!-- marqueurs ins√©r√©s ici par JS -->
    </div>
  </div>

   <div id="topBar">
    <div class="compass" id="drole">‚Üë Dr√¥le</div>
    <div class="compass" id="serieux">‚Üì S√©rieux</div>
    <div class="compass" id="individuel">‚Üê Individuel</div>
    <div class="compass" id="participatif">‚Üí Participatif</div>
  </div>

  <script src="app.js"></script>
<!-- <script type="module">
  // Import des modules Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  // ‚öôÔ∏è Configuration Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyD4d-pfOx24sF_h4rwsDWQufxsA6-1NBPI",
    authDomain: "carte-projets-ebd13.firebaseapp.com",
    projectId: "carte-projets-ebd13",
    storageBucket: "carte-projets-ebd13.firebasestorage.app",
    messagingSenderId: "533852570161",
    appId: "1:533852570161:web:22a10f742ab3dd146ecb10"
  };

  // üî• Initialisation
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // üë§ Authentification anonyme + pseudo al√©atoire
  let pseudo = "";
  signInAnonymously(auth)
    .then(() => console.log("Connect√© anonymement √† Firebase"))
    .catch(err => console.error(err));

  onAuthStateChanged(auth, user => {
    if (user) {
      const suffixe = Math.floor(Math.random() * 1000);
      const genre = Math.random() > 0.5 ? "Farfadet" : "Farfadette";
      pseudo = `${genre}${suffixe}`;
      console.log("Pseudo g√©n√©r√© :", pseudo);
    }
  });

  // üì§ Fonction pour ajouter un commentaire
  async function ajouterCommentaire(projetId, texte) {
    try {
      const docRef = await addDoc(collection(db, "commentaires"), {
        projetId: projetId,
        pseudo: pseudo,
        texte: texte,
        date: new Date()
      });
      console.log("Commentaire ajout√© avec ID :", docRef.id);
    } catch (e) {
      console.error("Erreur ajout commentaire :", e);
    }
  }

  // üìä Fonction pour voter
  async function voter(projetId, noteHumour, noteParticipation) {
    try {
      const docRef = doc(db, "projets", projetId);
      const docSnap = await getDoc(docRef);

      if (docSnap.exists()) {
        const data = docSnap.data();
        const nbVotes = (data.nbVotes || 0) + 1;

        const newHumour = ((data.humour || 0) * (nbVotes - 1) + noteHumour) / nbVotes;
        const newParticipation = ((data.participation || 0) * (nbVotes - 1) + noteParticipation) / nbVotes;

        await updateDoc(docRef, {
          humour: newHumour,
          participation: newParticipation,
          nbVotes: nbVotes
        });

        console.log("Vote mis √† jour !");
      } else {
        // Si le projet n‚Äôexiste pas encore, on le cr√©e :
        await setDoc(docRef, {
          humour: noteHumour,
          participation: noteParticipation,
          nbVotes: 1
        });
        console.log("Nouveau projet cr√©√© avec vote initial !");
      }
    } catch (e) {
      console.error("Erreur lors du vote :", e);
    }
  }

  // üß™ Exemple d‚Äôutilisation (tu pourras remplacer par des boutons)
  window.addEventListener("DOMContentLoaded", () => {
    // Exemple de test : un bouton dans ta page
    const btnVote = document.getElementById("btnVote");
    const btnComment = document.getElementById("btnComment");

    btnVote.addEventListener("click", () => voter("projet1", 8, 6));
    btnComment.addEventListener("click", () => ajouterCommentaire("projet1", "J‚Äôadore ce projet !"));
  });
</script>
<div id="svgContainer"></div>
<script>
  // charger le SVG via fetch
  fetch('/public/images/troll.svg')
    .then(resp => resp.text())
    .then(svgText => {
      document.getElementById('svgContainer').innerHTML = svgText;
      initStrokeScaling();
    });

  let currentZoom = 1; // 1 = normal, <1 = d√©zoom, >1 = zoom rapproch√©
  const MIN_ZOOM = 0.2;
  const MAX_ZOOM = 2;

  function initStrokeScaling() {
    const svg = document.querySelector('#svgContainer svg');
    const paths = svg.querySelectorAll('path');

    function updateStrokes() {
      const strokeFactor = map(currentZoom, MIN_ZOOM, MAX_ZOOM, 3, 0.2); 
      paths.forEach(path => {
        const base = parseFloat(path.getAttribute('data-base-stroke') || path.getAttribute('stroke-width') || 1);
        path.setAttribute('stroke-width', base * strokeFactor);
      });
    }

    // stocker la valeur de stroke originale
    paths.forEach(path => {
      if (!path.getAttribute('data-base-stroke')) {
        path.setAttribute('data-base-stroke', path.getAttribute('stroke-width') || 1);
      }
    });

    window.setZoom = (zoom) => {
      currentZoom = zoom;
      updateStrokes();
    };

    updateStrokes();
  }

  function map(value, inMin, inMax, outMin, outMax) {
    return outMin + ((value - inMin) * (outMax - outMin)) / (inMax - inMin);
  }
</script> -->

</body>
</html>
